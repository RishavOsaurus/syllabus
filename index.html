<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllabus Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Professional Dark Gaming Theme */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-card: rgba(17, 17, 17, 0.95);
            --border-primary: rgba(255, 255, 255, 0.1);
            --border-secondary: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --success: #00d4aa;
            --warning: #ffb020;
            --danger: #ff4757;
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-heavy: rgba(0, 0, 0, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(247, 147, 30, 0.03) 0%, transparent 50%);
        }

        .app-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 100vh;
            max-width: 100vw;
            position: relative;
        }

        /* Top Navigation */
        .top-nav {
            display: none;
            position: relative;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            padding: 1.5rem;
            width: 100%;
        }

        .top-nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .top-nav-brand {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .top-nav-brand h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
        }

        .top-nav-brand p {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 400;
        }

        /* XP Display for Mobile */
        .top-nav-xp {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            backdrop-filter: blur(20px);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .top-nav-level-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .top-nav-progress-container {
            position: relative;
            width: 70px;
            height: 70px;
            margin: 0 auto 1rem;
        }

        .top-nav-progress-ring {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .top-nav-xp-counter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .top-nav-xp-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        /* Mobile Navigation Items */
        .top-nav-section {
            margin-top: 1rem;
            width: 100%;
        }

        .top-nav-title {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }

        .top-nav-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .top-nav-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--shadow-light);
        }

        .top-nav-item.active {
            background: linear-gradient(135deg, 
                rgba(255, 107, 53, 0.2), 
                rgba(247, 147, 30, 0.2));
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
        }

        .top-nav-item-title {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            text-align: center;
        }

        .top-nav-item-progress {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .top-nav-progress-bar {
            width: 100%;
            height: 3px;
            background: var(--border-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .top-nav-progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        /* Mobile Course Dropdown */
        .mobile-course-dropdown {
            position: relative;
            width: 100%;
        }

        .mobile-dropdown-trigger {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            color: var(--text-primary);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .mobile-dropdown-trigger:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--shadow-light);
        }

        .mobile-dropdown-trigger.active {
            background: linear-gradient(135deg, 
                rgba(255, 107, 53, 0.2), 
                rgba(247, 147, 30, 0.2));
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
        }

        .mobile-dropdown-arrow {
            font-size: 0.75rem;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .mobile-dropdown-trigger.active .mobile-dropdown-arrow {
            transform: rotate(180deg);
            color: var(--accent-primary);
        }

        .mobile-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            margin-top: 0.5rem;
            box-shadow: 0 20px 80px var(--shadow-light);
            backdrop-filter: blur(20px);
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .mobile-dropdown-menu.active {
            max-height: 400px;
            overflow-y: auto;
        }

        .mobile-dropdown-item {
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .mobile-dropdown-item:last-child {
            border-bottom: none;
        }

        .mobile-dropdown-item:hover {
            background: var(--bg-secondary);
            border-color: var(--border-primary);
        }

        .mobile-dropdown-item.active {
            background: linear-gradient(135deg, 
                rgba(255, 107, 53, 0.2), 
                rgba(247, 147, 30, 0.2));
            border-left: 4px solid var(--accent-primary);
        }

        .mobile-dropdown-item-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .mobile-dropdown-item-progress {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .mobile-dropdown-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .mobile-dropdown-progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }
        /* Sidebar Styles */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .sidebar-content {
            position: relative;
            z-index: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .brand {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .brand h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .brand p {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 400;
        }

        /* XP Display */
        .xp-display {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
        }

        .progress-ring {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .progress-ring-bg {
            stroke: var(--border-primary);
        }

        .progress-ring-fill {
            stroke: var(--accent-primary);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 8px rgba(255, 107, 53, 0.5));
        }

        .xp-counter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .xp-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        /* Navigation */
        .nav-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .nav-title {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }

        .nav-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--shadow-light);
        }

        .nav-item.active {
            background: linear-gradient(135deg, 
                rgba(255, 107, 53, 0.2), 
                rgba(247, 147, 30, 0.2));
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
        }

        .nav-item-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .nav-item-progress {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 280px 1fr;
            }

            .xp-display {
                padding: 1.75rem;
            }

            .progress-container {
                width: 70px;
                height: 70px;
            }

            .level-badge {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                position: relative;
                display: block;
            }

            .top-nav {
                display: block;
            }

            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .content-wrapper {
                padding: 2rem 1rem;
            }

            .course-header {
                padding: 2rem 1rem;
                margin-top: 1rem;
            }

            .course-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .stat-card {
                padding: 1.5rem;
            }

            .unit-card {
                padding: 1.5rem;
            }

            .unit-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .unit-meta {
                text-align: left;
            }

            .objective-item {
                padding: 0.75rem;
            }

            .top-nav-content {
                padding: 0 1rem;
            }

            .dropdown-trigger {
                min-width: 150px;
            }
        }

        @media (max-width: 480px) {
            .content-wrapper {
                padding: 1.5rem 0.75rem;
            }

            .course-header {
                padding: 1.5rem 1rem;
            }

            .course-title {
                font-size: 1.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 1.25rem;
            }

            .stat-value {
                font-size: 2rem;
            }

            .unit-card {
                padding: 1.25rem;
            }

            .objective-group {
                padding-left: 1rem;
            }

            .objective-item {
                padding: 0.5rem;
                gap: 0.5rem;
            }

            .objective-text {
                font-size: 0.875rem;
            }

            .top-nav {
                padding: 1.5rem 1rem;
            }

            .top-nav-content {
                gap: 1rem;
            }

            .top-nav-brand {
                font-size: 1.25rem;
            }

            .dropdown-trigger {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                max-width: 250px;
            }

            .level-indicator {
                font-size: 0.8rem;
                padding: 0.4rem 0.75rem;
            }

            .xp-indicator {
                font-size: 0.8rem;
            }
        }

        /* Dropdown functionality for navigation */
        .nav-dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 0.5rem;
        }

        .nav-dropdown.expanded {
            max-height: 300px;
        }

        .nav-dropdown-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0.25rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .nav-dropdown-item:hover {
            border-color: var(--accent-primary);
            background: rgba(255, 107, 53, 0.1);
            color: var(--text-primary);
        }

        .nav-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .nav-expand-icon {
            transition: transform 0.3s ease;
            font-size: 0.75rem;
            color: var(--text-muted);
            opacity: 0.7;
        }

        .nav-expand-icon.expanded {
            transform: rotate(180deg);
            color: var(--accent-primary);
        }

        .nav-item-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .nav-item-progress {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        /* Main Content */
        .main-content {
            background: var(--bg-primary);
            overflow-y: auto;
            position: relative;
        }

        .content-wrapper {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .course-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 2rem;
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .course-title {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .completion-status {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .completion-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .completion-bar {
            width: 100%;
            height: 12px;
            background: var(--border-primary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .completion-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
        }

        .completion-percentage {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 64px var(--shadow-light);
            border-color: var(--accent-primary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        /* Unit Cards */
        .unit-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .unit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 80px var(--shadow-light);
            border-color: var(--accent-primary);
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .unit-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .unit-meta {
            text-align: right;
            color: var(--text-secondary);
        }

        .credit-hours {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .unit-progress {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .unit-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-primary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .unit-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }

        /* Objectives */
        .objectives-section {
            position: relative;
            z-index: 1;
        }

        .objective-group {
            margin-bottom: 2rem;
            padding-left: 1.5rem;
            border-left: 2px solid var(--border-primary);
            position: relative;
        }

        .objective-group::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            border-radius: 50%;
        }

        .objective-group-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .objective-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
        }

        .objective-item:hover {
            background: var(--bg-secondary);
            border-color: var(--border-primary);
        }

        .objective-item.completed {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--success);
        }

        .objective-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-primary);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .objective-checkbox:checked {
            background: var(--success);
            border-color: var(--success);
        }

        .objective-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 700;
            font-size: 0.75rem;
        }

        .objective-text {
            flex: 1;
            font-size: 0.9375rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .objective-item.completed .objective-text {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .objective-status {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        /* Loading State */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-primary);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        /* Login Page Responsive Styles */
        @media (max-width: 768px) {
            #login-page .bg-gray-900 {
                margin: 1rem;
                padding: 2rem 1.5rem;
            }

            #login-page h1 {
                font-size: 2rem;
            }

            #login-page input,
            #login-page button {
                padding: 0.875rem 1rem;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            #login-page .bg-gray-900 {
                margin: 0.5rem;
                padding: 1.5rem 1rem;
            }

            #login-page h1 {
                font-size: 1.75rem;
            }

            #login-page p {
                font-size: 0.875rem;
            }

            #login-page input,
            #login-page button {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center">
        <div class="bg-gray-900 p-8 rounded-lg shadow-2xl border border-gray-700 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">KNOWLEDGE FORGE</h1>
                <p class="text-gray-400">Access Your Learning Dashboard</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="username" name="username" required
                           class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="Enter username">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" name="password" required
                           class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="Enter password">
                </div>
                
                <button type="submit" id="login-btn"
                        class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                    Access Dashboard
                </button>
                
                <div id="login-error" class="hidden text-red-400 text-sm text-center"></div>
            </form>
        </div>
    </div>

    <div class="app-container" id="main-app" style="display: none;">
        <!-- Top Navigation for Mobile/Tablet -->
        <nav class="top-nav" id="top-nav">
            <div class="top-nav-content">
                <div class="top-nav-brand">
                    <h1>KNOWLEDGE FORGE</h1>
                    <p>Mastery Through Progress</p>
                </div>
                
                <!-- XP and Level Display for Mobile -->
                <div class="top-nav-xp">
                    <div class="top-nav-level-badge">
                        <span>⚡</span>
                        <span id="top-level-display">Level 1</span>
                    </div>
                    <div class="top-nav-progress-container">
                        <svg class="top-nav-progress-ring" viewBox="0 0 120 120">
                            <circle class="progress-ring-bg" cx="60" cy="60" r="54" fill="none" stroke-width="8"/>
                            <circle class="progress-ring-fill" cx="60" cy="60" r="54" fill="none" stroke-width="8" 
                                    stroke-dasharray="339.292" stroke-dashoffset="339.292" id="top-progress-circle"/>
                        </svg>
                        <div class="top-nav-xp-counter" id="top-xp-display">0</div>
                    </div>
                    <div class="top-nav-xp-label">Experience Points</div>
                </div>

                <!-- Navigation for Mobile -->
                <div class="top-nav-section">
                    <div class="top-nav-title">Courses</div>
                    <div class="mobile-course-dropdown">
                        <button class="mobile-dropdown-trigger" id="mobile-course-dropdown-trigger">
                            <span id="mobile-selected-course">Select Course</span>
                            <span class="mobile-dropdown-arrow">▼</span>
                        </button>
                        <div class="mobile-dropdown-menu" id="mobile-course-dropdown-menu">
                            <!-- Course dropdown items will be injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <div class="brand">
                    <h1>KNOWLEDGE FORGE</h1>
                    <p>Mastery Through Progress</p>
                </div>
                
                <!-- XP and Level Display -->
                <div class="xp-display">
                    <div class="xp-content">
                        <div class="level-badge">
                            <span>⚡</span>
                            <span>Level <span id="level-display">1</span></span>
                        </div>
                        <div class="progress-container">
                            <svg class="progress-ring" viewBox="0 0 80 80">
                                <circle class="progress-ring-bg" cx="40" cy="40" r="32" stroke-width="6" fill="none" />
                                <circle id="progress-circle" class="progress-ring-fill" cx="40" cy="40" r="32" 
                                        stroke-width="6" fill="none" stroke-dasharray="201.06" stroke-dashoffset="201.06" />
                            </svg>
                            <div class="xp-counter" id="xp-counter">0</div>
                        </div>
                        <div class="xp-label">Experience Points</div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="nav-section">
                    <div class="nav-title">Courses</div>
                    <nav id="sidebar-nav">
                        <!-- Course navigation will be injected here -->
                    </nav>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-wrapper">
                <div id="loading-state" class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Initializing Knowledge Base</div>
                    <div class="loading-subtext">Preparing your learning journey...</div>
                </div>
                <!-- Course content will be injected here -->
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // --- BACKEND API CONFIGURATION ---
        const API_BASE_URL = 'https://syllabus-plum.vercel.app/api';
        let isAuthenticated = false;
        let currentUser = null;
        let authToken = null;

        // --- API FUNCTIONS ---
        async function checkBackendHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                console.log('🏥 Backend Health Check:', data);
                return true;
            } catch (error) {
                console.error('❌ Backend health check failed:', error);
                return false;
            }
        }

        async function authenticateUser(username, password) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                console.log('🔐 Authentication response:', data);

                if (data.success) {
                    isAuthenticated = true;
                    currentUser = data.user;
                    authToken = data.token;
                    
                    // Store token in localStorage for persistence
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    return true;
                } else {
                    return false;
                }
            } catch (error) {
                console.error('❌ Authentication failed:', error);
                return false;
            }
        }

        // Helper function to get auth headers
        function getAuthHeaders() {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            return headers;
        }

        async function loadProgressFromBackend() {
            try {
                const response = await fetch(`${API_BASE_URL}/progress/default_user`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    console.log('✅ Progress loaded from backend:', data.data);
                    return {
                        completedObjectives: data.data.completedObjectives || {},
                        activeSyllabus: data.data.activeSyllabus || null
                    };
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('❌ Failed to load progress from backend:', error);
                return { completedObjectives: {}, activeSyllabus: null };
            }
        }

        async function saveProgressToBackend(progressData) {
            try {
                const response = await fetch(`${API_BASE_URL}/progress/default_user`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(progressData)
                });

                const data = await response.json();
                
                if (data.success) {
                    console.log('✅ Progress saved to backend:', data.data);
                    return true;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('❌ Failed to save progress to backend:', error);
                return false;
            }
        }

        // --- AUTHENTICATION ---
        function checkStoredAuth() {
            const storedToken = localStorage.getItem('authToken');
            const storedUser = localStorage.getItem('currentUser');
            
            if (storedToken && storedUser) {
                authToken = storedToken;
                currentUser = JSON.parse(storedUser);
                isAuthenticated = true;
                console.log('✅ Found stored authentication token');
                return true;
            }
            
            return false;
        }
        
        function logout() {
            authToken = null;
            currentUser = null;
            isAuthenticated = false;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            
            // Redirect to login
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');
            const loginBtn = document.getElementById('login-btn');

            loginBtn.textContent = 'Authenticating...';
            loginBtn.disabled = true;

            authenticateUser(username, password).then(success => {
                if (success) {
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('main-app').style.display = 'grid';
                    initializeApp();
                } else {
                    errorDiv.textContent = 'Invalid username or password';
                    errorDiv.classList.remove('hidden');
                    setTimeout(() => {
                        errorDiv.classList.add('hidden');
                    }, 3000);
                }
                
                loginBtn.textContent = 'Access Dashboard';
                loginBtn.disabled = false;
            });
        }

        // --- MAIN APPLICATION ---
        async function initializeApp() {
            console.log('🚀 Initializing Syllabus Tracker Application');
            
            // Check backend connection
            await checkBackendHealth();

            // --- SYLLABUS DATA ---
            // --- DOM ELEMENTS ---
            const sidebarNav = document.getElementById('sidebar-nav');
            const mainContent = document.querySelector('.main-content .content-wrapper');
            const xpCounter = document.getElementById('xp-counter');
            const loadingState = document.getElementById('loading-state');

            // --- STATE MANAGEMENT ---
            let syllabiData = {};
            let progressData = await loadProgressFromBackend();
            let completedObjectives = progressData.completedObjectives || {};
            let activeSyllabus = progressData.activeSyllabus || null;
            let totalObjectives = 0;
            let completedCount = 0;

            // --- FUNCTIONS ---
            async function saveProgress() {
                const progressData = {
                    completedObjectives,
                    activeSyllabus
                };
                await saveProgressToBackend(progressData);
            }

            async function loadData() {
                try {
                    loadingState.innerHTML = `
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading syllabus data...</div>
                        <div class="loading-subtext">Fetching syllabi from backend...</div>
                    `;
                    
                    // Fetch syllabi from backend
                    const response = await fetch(`${API_BASE_URL}/syllabi`, {
                        headers: getAuthHeaders()
                    });
                    if (!response.ok) {
                        throw new Error(`Failed to fetch syllabi: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(result.message || 'Failed to load syllabi');
                    }
                    
                    // Process syllabi data
                    result.data.forEach(syllabus => {
                        parseJSON(syllabus);
                    });

                    if (Object.keys(syllabiData).length === 0) {
                        throw new Error("No syllabi found in database");
                    }

                    render();
                } catch (error) {
                    console.error("Error fetching or parsing syllabus data:", error);
                    mainContent.innerHTML = `<div class="text-center text-red-500">
                        <h2 class="text-2xl font-bold">Failed to load data</h2>
                        <p>Please check that the backend server is running and accessible.</p>
                        <p class="text-sm mt-2">Details: ${error.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            Retry
                        </button>
                    </div>`;
                }
            }

            function parseJSON(jsonData) {
                const courseName = jsonData.courseTitle || jsonData.courseCode || 'Course';
                
                if (!syllabiData[courseName]) {
                    syllabiData[courseName] = {};
                }
                
                jsonData.units.forEach(unit => {
                    const unitName = `Unit ${unit.unitTitle}`;
                    syllabiData[courseName][unitName] = {
                        creditHours: unit.creditHours,
                        subUnits: {}
                    };
                    
                    unit.topics.forEach((topic, topicIndex) => {
                        if (typeof topic === 'string') {
                            const subUnitName = `${topicIndex + 1}. ${topic}`;
                            syllabiData[courseName][unitName].subUnits[subUnitName] = {
                                points: 1,
                                objectives: [topic]
                            };
                        } else if (typeof topic === 'object' && topic.title) {
                            const subUnitName = `${topicIndex + 1}. ${topic.title}`;
                            
                            if (topic.subtopics && topic.subtopics.length > 0) {
                                syllabiData[courseName][unitName].subUnits[subUnitName] = {
                                    points: topic.subtopics.length,
                                    objectives: topic.subtopics
                                };
                            } else {
                                syllabiData[courseName][unitName].subUnits[subUnitName] = {
                                    points: 1,
                                    objectives: [topic.title]
                                };
                            }
                        }
                    });
                });
                
                if (!activeSyllabus && Object.keys(syllabiData).length > 0) {
                    activeSyllabus = Object.keys(syllabiData)[0];
                }
            }

            function render() {
                if (Object.keys(syllabiData).length === 0) return;
                loadingState.style.display = 'none';
                calculateStats();
                renderSidebar();
                renderMainContent();
                updateXPDisplay();
            }

            function calculateStats() {
                totalObjectives = 0;
                completedCount = 0;
                
                Object.values(syllabiData).forEach(syllabus => {
                    Object.values(syllabus).forEach(unit => {
                        Object.values(unit.subUnits).forEach(subUnit => {
                            totalObjectives += subUnit.objectives.length;
                        });
                    });
                });

                completedCount = Object.values(completedObjectives).filter(Boolean).length;
            }

            function updateXPDisplay() {
                const totalXp = completedCount;
                const level = Math.floor(totalXp / 10) + 1;
                
                let totalWeightedProgress = 0;
                let totalCreditHours = 0;
                
                Object.keys(syllabiData).forEach(syllabusName => {
                    const courseCompletion = getCourseCompletion(syllabusName);
                    const courseCreditHours = getTotalCreditHours(syllabusName);
                    
                    totalWeightedProgress += (courseCompletion * courseCreditHours);
                    totalCreditHours += courseCreditHours;
                });
                
                const overallProgress = totalCreditHours > 0 ? totalWeightedProgress / totalCreditHours : 0;
                const progressInLevel = overallProgress / 100;
                const circumference = 2 * Math.PI * 32;
                const offset = circumference - (progressInLevel * circumference);

                document.getElementById('xp-counter').textContent = totalXp;
                document.getElementById('level-display').textContent = level;
                document.getElementById('progress-circle').style.strokeDashoffset = offset;
                
                // Update top navigation XP display
                const topXpDisplay = document.getElementById('top-xp-display');
                const topLevelDisplay = document.getElementById('top-level-display');
                
                if (topXpDisplay) topXpDisplay.textContent = totalXp;
                if (topLevelDisplay) topLevelDisplay.textContent = `Level ${level}`;
            }

            function renderSidebar() {
                const navHtml = Object.keys(syllabiData).map(name => {
                    const courseCompletion = getCourseCompletion(name);
                    const isActive = activeSyllabus === name;
                    
                    return `
                        <div class="nav-item ${isActive ? 'active' : ''}" onclick="setActiveSyllabus('${name}')">
                            <div class="nav-item-title">${name}</div>
                            <div class="nav-item-progress">${courseCompletion}% Complete</div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" style="width: ${courseCompletion}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                sidebarNav.innerHTML = navHtml;
                
                // Update top navigation for mobile
                updateTopNavigation();
            }

            function updateTopNavigation() {
                const mobileDropdownMenu = document.getElementById('mobile-course-dropdown-menu');
                const mobileSelectedCourse = document.getElementById('mobile-selected-course');
                
                if (mobileDropdownMenu && mobileSelectedCourse) {
                    // Update selected course display
                    if (activeSyllabus) {
                        mobileSelectedCourse.textContent = activeSyllabus;
                    } else {
                        mobileSelectedCourse.textContent = 'Select Course';
                    }
                    
                    // Create mobile dropdown items
                    mobileDropdownMenu.innerHTML = Object.keys(syllabiData).map(name => {
                        const courseCompletion = getCourseCompletion(name);
                        const isActive = activeSyllabus === name;
                        
                        return `
                            <div class="mobile-dropdown-item ${isActive ? 'active' : ''}" onclick="selectMobileCourse('${name}')">
                                <div class="mobile-dropdown-item-title">${name}</div>
                                <div class="mobile-dropdown-item-progress">${courseCompletion}% Complete</div>
                                <div class="mobile-dropdown-progress-bar">
                                    <div class="mobile-dropdown-progress-bar-fill" style="width: ${courseCompletion}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            function getCourseCompletion(syllabusName) {
                const syllabus = syllabiData[syllabusName];
                let totalWeightedProgress = 0;
                let totalCreditHours = 0;

                Object.entries(syllabus).forEach(([unitName, unitData]) => {
                    const unitCompletion = getUnitCompletion(syllabusName, unitName);
                    const creditHours = unitData.creditHours || 1;
                    
                    totalWeightedProgress += (unitCompletion * creditHours);
                    totalCreditHours += creditHours;
                });

                return totalCreditHours > 0 ? Math.round(totalWeightedProgress / totalCreditHours) : 0;
            }

            function renderMainContent() {
                if (!activeSyllabus || !syllabiData[activeSyllabus]) {
                    mainContent.innerHTML = `
                        <div class="course-header">
                            <div class="course-header-content">
                                <h1 class="course-title">Select Your Path</h1>
                                <p style="color: var(--text-secondary); font-size: 1.125rem;">Choose a course from the sidebar to begin your journey</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const syllabus = syllabiData[activeSyllabus];
                const completion = getCourseCompletion(activeSyllabus);
                
                let html = `
                    <div class="course-header">
                        <div class="course-header-content">
                            <h1 class="course-title">${activeSyllabus}</h1>
                            
                            <div class="completion-status">
                                <div class="completion-text">
                                    ${completion === 100 ? '🎯 Mission Complete!' : `${Math.round(100 - completion)}% Remaining`}
                                </div>
                                <div class="completion-bar">
                                    <div class="completion-bar-fill" style="width: ${completion}%"></div>
                                </div>
                                <div class="completion-percentage">${completion}% Complete</div>
                            </div>

                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">${Object.keys(syllabus).length}</div>
                                    <div class="stat-label">Units</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${getCourseObjectivesCount(activeSyllabus)}</div>
                                    <div class="stat-label">Total Objectives</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${getCourseCompletedCount(activeSyllabus)}</div>
                                    <div class="stat-label">Completed</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${getTotalCreditHours(activeSyllabus)}</div>
                                    <div class="stat-label">Credit Hours</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                for (const [unitName, unitData] of Object.entries(syllabus)) {
                    const unitCompletion = getUnitCompletion(activeSyllabus, unitName);
                    
                    html += `
                        <div class="unit-card" id="unit-${unitName.replace(/\s+/g, '-')}">
                            <div class="unit-header">
                                <div>
                                    <h2 class="unit-title">${unitName}</h2>
                                </div>
                                <div class="unit-meta">
                                    <div class="credit-hours">${unitData.creditHours} Credit Hours</div>
                                    <div class="unit-progress">${unitCompletion}%</div>
                                </div>
                            </div>
                            
                            <div class="unit-progress-bar">
                                <div class="unit-progress-fill" style="width: ${unitCompletion}%"></div>
                            </div>
                            
                            <div class="objectives-section">
                    `;
                    
                    for (const [subUnitName, subUnitData] of Object.entries(unitData.subUnits)) {
                        html += `
                            <div class="objective-group">
                                <h3 class="objective-group-title">${subUnitName}</h3>
                        `;
                        
                        subUnitData.objectives.forEach((objective, index) => {
                            const key = `${activeSyllabus}-${unitName}-${subUnitName}-${objective}`;
                            const isCompleted = !!completedObjectives[key];
                            html += `
                                <div class="objective-item ${isCompleted ? 'completed' : ''}">
                                    <input type="checkbox" 
                                           class="objective-checkbox"
                                           id="${key}" 
                                           ${isCompleted ? 'checked' : ''} 
                                           onclick="handleObjectiveClick('${key}')" />
                                    <label for="${key}" class="objective-text">
                                        ${objective}
                                    </label>
                                    <span class="objective-status">
                                        ${isCompleted ? '✅' : '⭕'}
                                    </span>
                                </div>
                            `;
                        });
                        html += `</div>`;
                    }
                    html += `</div></div>`;
                }
                mainContent.innerHTML = html;
            }

            function getUnitCompletion(syllabusName, unitName) {
                const unitData = syllabiData[syllabusName][unitName];
                let totalUnitObjectives = 0;
                let completedUnitObjectives = 0;

                Object.entries(unitData.subUnits).forEach(([subUnitName, subUnitData]) => {
                    subUnitData.objectives.forEach(objective => {
                        totalUnitObjectives++;
                        const key = `${syllabusName}-${unitName}-${subUnitName}-${objective}`;
                        if (completedObjectives[key]) {
                            completedUnitObjectives++;
                        }
                    });
                });

                return totalUnitObjectives > 0 ? Math.round((completedUnitObjectives / totalUnitObjectives) * 100) : 0;
            }

            function getTotalCreditHours(syllabusName) {
                const syllabus = syllabiData[syllabusName];
                let totalCreditHours = 0;
                
                Object.values(syllabus).forEach(unitData => {
                    totalCreditHours += unitData.creditHours || 1;
                });
                
                return totalCreditHours;
            }

            function getCourseObjectivesCount(syllabusName) {
                const syllabus = syllabiData[syllabusName];
                let count = 0;
                Object.values(syllabus).forEach(unit => {
                    Object.values(unit.subUnits).forEach(subUnit => {
                        count += subUnit.objectives.length;
                    });
                });
                return count;
            }

            function getCourseCompletedCount(syllabusName) {
                const syllabus = syllabiData[syllabusName];
                let count = 0;
                Object.entries(syllabus).forEach(([unitName, unitData]) => {
                    Object.entries(unitData.subUnits).forEach(([subUnitName, subUnitData]) => {
                        subUnitData.objectives.forEach(objective => {
                            const key = `${syllabusName}-${unitName}-${subUnitName}-${objective}`;
                            if (completedObjectives[key]) {
                                count++;
                            }
                        });
                    });
                });
                return count;
            }

            // --- EVENT HANDLERS ---
            window.setActiveSyllabus = async (name) => {
                activeSyllabus = name;
                await saveProgress();
                render();
                
                // Close dropdown after selection
                closeTopDropdown();
            };

            window.handleObjectiveClick = async (key) => {
                const wasCompleted = !!completedObjectives[key];
                completedObjectives[key] = !wasCompleted;
                await saveProgress();

                if (!wasCompleted) {
                    // Quick confetti burst for completion
                    if (window.confetti) {
                        confetti({
                            particleCount: 30,
                            spread: 45,
                            origin: { y: 0.7 }
                        });
                    }
                }

                render();
            };

            // Mobile dropdown functions
            window.selectMobileCourse = async (courseName) => {
                activeSyllabus = courseName;
                await saveProgress();
                render();
                closeMobileDropdown();
            };

            function setupMobileDropdown() {
                const mobileDropdownTrigger = document.getElementById('mobile-course-dropdown-trigger');
                const mobileDropdownMenu = document.getElementById('mobile-course-dropdown-menu');

                if (mobileDropdownTrigger && mobileDropdownMenu) {
                    mobileDropdownTrigger.addEventListener('click', toggleMobileDropdown);
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!mobileDropdownTrigger.contains(e.target) && !mobileDropdownMenu.contains(e.target)) {
                            closeMobileDropdown();
                        }
                    });
                }
            }

            function toggleMobileDropdown() {
                const mobileDropdownTrigger = document.getElementById('mobile-course-dropdown-trigger');
                const mobileDropdownMenu = document.getElementById('mobile-course-dropdown-menu');
                
                if (mobileDropdownTrigger && mobileDropdownMenu) {
                    const isActive = mobileDropdownMenu.classList.contains('active');
                    
                    if (isActive) {
                        closeMobileDropdown();
                    } else {
                        openMobileDropdown();
                    }
                }
            }

            function openMobileDropdown() {
                const mobileDropdownTrigger = document.getElementById('mobile-course-dropdown-trigger');
                const mobileDropdownMenu = document.getElementById('mobile-course-dropdown-menu');
                
                if (mobileDropdownTrigger && mobileDropdownMenu) {
                    mobileDropdownTrigger.classList.add('active');
                    mobileDropdownMenu.classList.add('active');
                }
            }

            function closeMobileDropdown() {
                const mobileDropdownTrigger = document.getElementById('mobile-course-dropdown-trigger');
                const mobileDropdownMenu = document.getElementById('mobile-course-dropdown-menu');
                
                if (mobileDropdownTrigger && mobileDropdownMenu) {
                    mobileDropdownTrigger.classList.remove('active');
                    mobileDropdownMenu.classList.remove('active');
                }
            }

            // Top navigation dropdown functions
            function setupTopNavigation() {
                const dropdownTrigger = document.getElementById('course-dropdown-trigger');
                const dropdownMenu = document.getElementById('course-dropdown-menu');

                if (dropdownTrigger && dropdownMenu) {
                    dropdownTrigger.addEventListener('click', toggleTopDropdown);
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!dropdownTrigger.contains(e.target) && !dropdownMenu.contains(e.target)) {
                            closeTopDropdown();
                        }
                    });
                }
            }

            function toggleTopDropdown() {
                const dropdownTrigger = document.getElementById('course-dropdown-trigger');
                const dropdownMenu = document.getElementById('course-dropdown-menu');
                
                if (dropdownTrigger && dropdownMenu) {
                    const isActive = dropdownMenu.classList.contains('active');
                    
                    if (isActive) {
                        closeTopDropdown();
                    } else {
                        openTopDropdown();
                    }
                }
            }

            function openTopDropdown() {
                const dropdownTrigger = document.getElementById('course-dropdown-trigger');
                const dropdownMenu = document.getElementById('course-dropdown-menu');
                
                if (dropdownTrigger && dropdownMenu) {
                    dropdownTrigger.classList.add('active');
                    dropdownMenu.classList.add('active');
                }
            }

            function closeTopDropdown() {
                const dropdownTrigger = document.getElementById('course-dropdown-trigger');
                const dropdownMenu = document.getElementById('course-dropdown-menu');
                
                if (dropdownTrigger && dropdownMenu) {
                    dropdownTrigger.classList.remove('active');
                    dropdownMenu.classList.remove('active');
                }
            }

            // Setup navigation after DOM is ready
            setupTopNavigation();
            setupMobileDropdown();

            // --- INITIALIZATION ---
            loadData();
        }

        // --- STARTUP ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🌟 Syllabus Tracker Frontend Loaded');
            
            // Check backend health on startup
            checkBackendHealth();
            
            // Check for stored authentication
            if (checkStoredAuth()) {
                // User is already logged in, skip login page
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'grid';
                initializeApp();
            } else {
                // Show login page
                document.getElementById('login-page').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
            
            // Set up login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
        });
    </script>
</body>
</html>
